## ch 6

### 문자열 연결 CONCAT

```sql
CREATE TABLE `sql_recipe.mst_user_location` (
    user_id   STRING
  , pref_name STRING
  , city_name STRING
);

INSERT INTO `sql_recipe.mst_user_location`
VALUES
    ('U001', '서울특별시', '강서구')
  , ('U002', '경기도수원시', '장안구'  )
  , ('U003', '제주특별자치도', '서귀포시')
;

SELECT 
  user_id,
  CONCAT(pref_name, ' ', city_name)
FROM `sql_recipe.mst_user_location`
```

### 여러개 값 비교하기 

SIGN: 양수일때 1, 0이면 0, 음수면 -1 리턴

```sql
CREATE TABLE `sql_recipe.quarterly_sales` (
    year integer
  , q1   integer
  , q2   integer
  , q3   integer
  , q4   integer
);

INSERT INTO `sql_recipe.quarterly_sales`
VALUES
    (2015, 82000, 83000, 78000, 83000)
  , (2016, 85000, 85000, 80000, 81000)
  , (2017, 92000, 81000, NULL , NULL )
;

SELECT 
  year,
  q1,
  q2,
  CASE 
    WHEN q1 < q2 THEN '+'
    WHEN q1 = q2 THEN ''
    ELSE '-'
  END,
  q2 - q1 AS diff_q2_q1,
  SIGN(q2-q1) AS sign_q2_q1
FROM `sql_recipe.quarterly_sales`
```

### 연중 최소/최대 분기 매출 찾기 

GREATEST() 
LEAST() 

```sql
SELECT 
  year,
  GREATEST(q1, q2, q3, q4) AS greatest_sales,
  LEAST(q1, q2, q3, q4) AS least_sales
FROM `sql_recipe.quarterly_sales`
ORDER BY year
```

### 연간 평규 4분기 매출 계산 

NULL을 0으로 할 수도 있지만 
NULL 인것은 분모 숫자에서 빼 수도 있음. 

```sql
SELECT 
  year,
  (COALESCE(q1,0) + COALESCE(q2,0) + COALESCE(q3,0) + COALESCE(q4,0)) / 4
FROM `sql_recipe.quarterly_sales`
ORDER BY year

SELECT 
  year,
  (COALESCE(q1,0) + COALESCE(q2,0) + COALESCE(q3,0) + COALESCE(q4,0)) / 
  (SIGN(COALESCE(q1,0)) + SIGN(COALESCE(q2,0)) + SIGN(COALESCE(q3,0)) + SIGN(COALESCE(q4,0)))
FROM `sql_recipe.quarterly_sales`
ORDER BY year
```

### 2개의 값 비율 계산 
